Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"BranchesTreeState\">\r\n    <expand>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"LOCAL_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"GROUP_NODE:origin\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n    </expand>\r\n    <select>\r\n      <path>\r\n        <item name=\"ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"REMOTE_ROOT\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"GROUP_NODE:origin\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n        <item name=\"BRANCH:origin/gitll\" type=\"e8cecc67:BranchNodeDescriptor\" />\r\n      </path>\r\n    </select>\r\n  </component>\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"a0dac186-9019-463a-9c2e-c3fb3065d3d9\" name=\"默认更改列表\" comment=\"\">\r\n      <change beforePath=\"$PROJECT_DIR$/core/order-pay.js\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/core/order-pay.js\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"ComposerSettings\">\r\n    <execution />\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_BRANCH_BY_REPOSITORY\">\r\n      <map>\r\n        <entry key=\"$PROJECT_DIR$\" value=\"gitll\" />\r\n      </map>\r\n    </option>\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"1kovTJiAtU3FWmmrKqoh8WmR75r\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">\r\n    <property name=\"RunOnceActivity.OpenProjectViewOnStart\" value=\"true\" />\r\n    <property name=\"WebServerToolWindowFactoryState\" value=\"false\" />\r\n    <property name=\"aspect.path.notification.shown\" value=\"true\" />\r\n    <property name=\"last_opened_file_path\" value=\"$PROJECT_DIR$/../../../xiaopi/phpstudy_pro/WWW/hd\" />\r\n    <property name=\"node.js.detected.package.eslint\" value=\"true\" />\r\n    <property name=\"node.js.detected.package.tslint\" value=\"true\" />\r\n    <property name=\"node.js.path.for.package.eslint\" value=\"project\" />\r\n    <property name=\"node.js.path.for.package.tslint\" value=\"project\" />\r\n    <property name=\"node.js.selected.package.eslint\" value=\"(autodetect)\" />\r\n    <property name=\"node.js.selected.package.tslint\" value=\"(autodetect)\" />\r\n    <property name=\"vue.rearranger.settings.migration\" value=\"true\" />\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"a0dac186-9019-463a-9c2e-c3fb3065d3d9\" name=\"默认更改列表\" comment=\"\" />\r\n      <created>1606379764423</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1606379764423</updated>\r\n      <workItem from=\"1606379765556\" duration=\"4577000\" />\r\n      <workItem from=\"1606397406491\" duration=\"15000\" />\r\n      <workItem from=\"1606437750963\" duration=\"4137000\" />\r\n      <workItem from=\"1606465712428\" duration=\"2021000\" />\r\n      <workItem from=\"1606629591158\" duration=\"2431000\" />\r\n      <workItem from=\"1606696186584\" duration=\"19888000\" />\r\n      <workItem from=\"1606783378952\" duration=\"16456000\" />\r\n      <workItem from=\"1606955688348\" duration=\"2124000\" />\r\n    </task>\r\n    <task id=\"LOCAL-00001\" summary=\"更新积分商城中分类\">\r\n      <created>1606469250408</created>\r\n      <option name=\"number\" value=\"00001\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00001\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1606469250408</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00002\" summary=\"界面\">\r\n      <created>1606716329300</created>\r\n      <option name=\"number\" value=\"00002\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00002\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1606716329301</updated>\r\n    </task>\r\n    <task id=\"LOCAL-00003\" summary=\"订阅消息\">\r\n      <created>1606727833134</created>\r\n      <option name=\"number\" value=\"00003\" />\r\n      <option name=\"presentableId\" value=\"LOCAL-00003\" />\r\n      <option name=\"project\" value=\"LOCAL\" />\r\n      <updated>1606727833134</updated>\r\n    </task>\r\n    <option name=\"localTasksCounter\" value=\"4\" />\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n    <option name=\"oldMeFiltersMigrated\" value=\"true\" />\r\n  </component>\r\n  <component name=\"VcsManagerConfiguration\">\r\n    <MESSAGE value=\"更新积分商城中分类\" />\r\n    <MESSAGE value=\"界面\" />\r\n    <MESSAGE value=\"订阅消息\" />\r\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"订阅消息\" />\r\n  </component>\r\n  <component name=\"WindowStateProjectService\">\r\n    <state x=\"686\" y=\"211\" key=\"FileChooserDialogImpl\" timestamp=\"1606960049480\">\r\n      <screen x=\"0\" y=\"0\" width=\"1920\" height=\"1040\" />\r\n    </state>\r\n    <state x=\"549\" y=\"167\" key=\"FileChooserDialogImpl/0.0.1536.824/1920.0.1920.1040@0.0.1536.824\" timestamp=\"1606726554446\" />\r\n    <state x=\"686\" y=\"211\" key=\"FileChooserDialogImpl/0.0.1920.1040/1920.0.1920.1040@0.0.1920.1040\" timestamp=\"1606960049480\" />\r\n    <state x=\"593\" y=\"255\" key=\"IDE.errors.dialog\" timestamp=\"1606898750590\">\r\n      <screen x=\"0\" y=\"0\" width=\"1920\" height=\"1040\" />\r\n    </state>\r\n    <state x=\"593\" y=\"255\" key=\"IDE.errors.dialog/0.0.1920.1040/1920.0.1920.1040@0.0.1920.1040\" timestamp=\"1606898750590\" />\r\n    <state width=\"498\" height=\"446\" key=\"SwitcherDM\" timestamp=\"1606789637136\">\r\n      <screen x=\"1920\" y=\"0\" width=\"1920\" height=\"1040\" />\r\n    </state>\r\n    <state width=\"498\" height=\"446\" key=\"SwitcherDM/0.0.1536.824/1920.0.1920.1040@1920.0.1920.1040\" timestamp=\"1606789637136\" />\r\n    <state x=\"361\" y=\"145\" key=\"Vcs.Push.Dialog.v2\" timestamp=\"1606727836293\">\r\n      <screen x=\"0\" y=\"0\" width=\"1536\" height=\"824\" />\r\n    </state>\r\n    <state x=\"361\" y=\"145\" key=\"Vcs.Push.Dialog.v2/0.0.1536.824/1920.0.1920.1040@0.0.1536.824\" timestamp=\"1606727836293\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/workspace.xml	(revision a2bccea3733dbced41cc15afb97d9268c0474570)
+++ .idea/workspace.xml	(date 1606974609083)
@@ -26,8 +26,10 @@
     </select>
   </component>
   <component name="ChangeListManager">
-    <list default="true" id="a0dac186-9019-463a-9c2e-c3fb3065d3d9" name="默认更改列表" comment="">
+    <list default="true" id="a0dac186-9019-463a-9c2e-c3fb3065d3d9" name="默认更改列表" comment="订阅信息的更新">
+      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/core/order-pay.js" beforeDir="false" afterPath="$PROJECT_DIR$/core/order-pay.js" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/pages/miaosha/order-detail/order-detail.wxml" beforeDir="false" afterPath="$PROJECT_DIR$/pages/miaosha/order-detail/order-detail.wxml" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -101,7 +103,14 @@
       <option name="project" value="LOCAL" />
       <updated>1606727833134</updated>
     </task>
-    <option name="localTasksCounter" value="4" />
+    <task id="LOCAL-00004" summary="订阅信息的更新">
+      <created>1606966948667</created>
+      <option name="number" value="00004" />
+      <option name="presentableId" value="LOCAL-00004" />
+      <option name="project" value="LOCAL" />
+      <updated>1606966948667</updated>
+    </task>
+    <option name="localTasksCounter" value="5" />
     <servers />
   </component>
   <component name="TypeScriptGeneratedFilesManager">
@@ -123,7 +132,8 @@
     <MESSAGE value="更新积分商城中分类" />
     <MESSAGE value="界面" />
     <MESSAGE value="订阅消息" />
-    <option name="LAST_COMMIT_MESSAGE" value="订阅消息" />
+    <MESSAGE value="订阅信息的更新" />
+    <option name="LAST_COMMIT_MESSAGE" value="订阅信息的更新" />
   </component>
   <component name="WindowStateProjectService">
     <state x="686" y="211" key="FileChooserDialogImpl" timestamp="1606960049480">
@@ -139,9 +149,10 @@
       <screen x="1920" y="0" width="1920" height="1040" />
     </state>
     <state width="498" height="446" key="SwitcherDM/0.0.1536.824/1920.0.1920.1040@1920.0.1920.1040" timestamp="1606789637136" />
-    <state x="361" y="145" key="Vcs.Push.Dialog.v2" timestamp="1606727836293">
-      <screen x="0" y="0" width="1536" height="824" />
+    <state x="2371" y="183" key="Vcs.Push.Dialog.v2" timestamp="1606966951779">
+      <screen x="1920" y="0" width="1920" height="1040" />
     </state>
     <state x="361" y="145" key="Vcs.Push.Dialog.v2/0.0.1536.824/1920.0.1920.1040@0.0.1536.824" timestamp="1606727836293" />
+    <state x="2371" y="183" key="Vcs.Push.Dialog.v2/0.0.1536.824/1920.0.1920.1040@1920.0.1920.1040" timestamp="1606966951779" />
   </component>
 </project>
\ No newline at end of file
Index: core/order-pay.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>var app = getApp();\r\n\r\nfunction setOnShowScene(e) {\r\n    app.onShowData || (app.onShowData = {}), app.onShowData.scene = e;\r\n}\r\n\r\nvar pay = {\r\n    init: function (l, e) {\r\n        var _ = this, A = getApp().api;\r\n        _.page = l, app = e;\r\n        var m = getApp().core.getStorageSync(getApp().const.PARENT_ID);\r\n        m || (m = 0), _.page.orderPay = function (e) {\r\n            var t = e.currentTarget.dataset.index, o = _.page.data.order_list[t], a = new Array();\r\n            if (void 0 !== _.page.data.pay_type_list) a = _.page.data.pay_type_list; else if (void 0 !== o.pay_type_list) a = o.pay_type_list; else if (void 0 !== o.goods_list[0].pay_type_list) a = o.goods_list[0].pay_type_list; else {\r\n                var r = {\r\n                    payment: 0\r\n                };\r\n                a.push(r);\r\n            }\r\n            var p = getCurrentPages(), s = p[p.length - 1].route, n = {};\r\n            if (-1 != s.indexOf(\"pt\")) c = A.group.pay_data, n.order_id = o.order_id; else if (-1 != s.indexOf(\"miaosha\")) c = A.miaosha.pay_data,\r\n                n.order_id = o.order_id; else if (-1 != s.indexOf(\"book\")) c = A.book.order_pay,\r\n                n.id = o.id; else {\r\n                var c = A.order.pay_data;\r\n                n.order_id = o.order_id;\r\n            }\r\n\r\n            function i(e, t, o) {\r\n                e.pay_type = \"WECHAT_PAY\", app.request({\r\n                    url: t,\r\n                    data: e,\r\n                    complete: function () {\r\n                        getApp().core.hideLoading();\r\n                    },\r\n                    success: function (e) {\r\n                        0 == e.code && (setOnShowScene(\"pay\"), getApp().core.requestPayment({\r\n                            _res: e,\r\n                            timeStamp: e.data.timeStamp,\r\n                            nonceStr: e.data.nonceStr,\r\n                            package: e.data.package,\r\n                            signType: e.data.signType,\r\n                            paySign: e.data.paySign,\r\n                            success: function (e) {\r\n                            },\r\n                            fail: function (e) {\r\n                            },\r\n                            complete: function (e) {\r\n                                \"requestPayment:fail\" != e.errMsg && \"requestPayment:fail cancel\" != e.errMsg ? getApp().core.redirectTo({\r\n                                    url: \"/\" + o + \"?status=1\"\r\n                                }) : getApp().core.showModal({\r\n                                    title: \"提示\",\r\n                                    content: \"订单尚未支付\",\r\n                                    showCancel: !1,\r\n                                    confirmText: \"确认\",\r\n                                    success: function (e) {\r\n                                        e.confirm && getApp().core.redirectTo({\r\n                                            url: \"/\" + o + \"?status=0\"\r\n                                        });\r\n                                    }\r\n                                });\r\n                            }\r\n                        })), 1 == e.code && getApp().core.showToast({\r\n                            title: e.msg,\r\n                            image: \"/images/icon-warning.png\"\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n\r\n            function d(t, o, a) {\r\n                t.pay_type = \"BALANCE_PAY\";\r\n                var e = getApp().getUser();\r\n                getApp().core.showModal({\r\n                    title: \"当前账户余额：\" + e.money,\r\n                    content: \"是否使用余额\",\r\n                    success: function (e) {\r\n                        e.confirm && (getApp().core.showLoading({\r\n                            title: \"正在提交\",\r\n                            mask: !0\r\n                        }), app.request({\r\n                            url: o,\r\n                            data: t,\r\n                            complete: function () {\r\n                                getApp().core.hideLoading();\r\n                            },\r\n                            success: function (e) {\r\n                                0 == e.code && getApp().core.redirectTo({\r\n                                    url: \"/\" + a + \"?status=1\"\r\n                                }), 1 == e.code && getApp().core.showModal({\r\n                                    title: \"提示\",\r\n                                    content: e.msg,\r\n                                    showCancel: !1\r\n                                });\r\n                            }\r\n                        }));\r\n                    }\r\n                });\r\n            }\r\n\r\n            n.parent_id = m, n.condition = 2, 1 == a.length ? (getApp().core.showLoading({\r\n                title: \"正在提交\",\r\n                mask: !0\r\n            }), 0 == a[0].payment && i(n, c, s), 3 == a[0].payment && d(n, c, s)) : getApp().core.showModal({\r\n                title: \"提示\",\r\n                content: \"选择支付方式\",\r\n                cancelText: \"余额支付\",\r\n                confirmText: \"线上支付\",\r\n                success: function (e) {\r\n                    e.confirm ? (getApp().core.showLoading({\r\n                        title: \"正在提交\",\r\n                        mask: !0\r\n                    }), i(n, c, s)) : e.cancel && d(n, c, s);\r\n                }\r\n            });\r\n        }, _.page.order_submit = function (r, g) {\r\n            var e = A.order.submit, p = A.order.pay_data, u = \"/pages/order/order\";\r\n            if (\"pt\" == g ? (e = A.group.submit, p = A.group.pay_data, u = \"/pages/pt/order/order\") : \"ms\" == g ? (e = A.miaosha.submit,\r\n                p = A.miaosha.pay_data, u = \"/pages/miaosha/order/order\") : \"pond\" == g ? (e = A.pond.submit,\r\n                p = A.order.pay_data, u = \"/pages/order/order\") : \"scratch\" == g ? (e = A.scratch.submit,\r\n                p = A.order.pay_data, u = \"/pages/order/order\") : \"lottery\" == g ? (e = A.lottery.submit,\r\n                p = A.order.pay_data, u = \"/pages/order/order\") : \"step\" == g ? (e = A.step.submit,\r\n                p = A.order.pay_data, u = \"/pages/order/order\") : \"s\" == g && (e = A.order.new_submit,\r\n                p = A.order.pay_data, u = \"/pages/order/order\"), 3 == r.payment) {\r\n                var t = getApp().getUser();\r\n                getApp().core.showModal({\r\n                    title: \"当前账户余额：\" + t.money,\r\n                    content: \"是否确定使用余额支付\",\r\n                    success: function (e) {\r\n                        e.confirm && o();\r\n                    }\r\n                });\r\n            } else o();\r\n\r\n            function o() {\r\n                var appId = 'wx257210a837db11b0'\r\n                var appSecret = '512c724e265ce71c6868ba0aa0636bd3'\r\n                var url = 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=' + appId + '&secret=' + appSecret;\r\n                wx.request({\r\n                    url,\r\n                    success: (res) => {\r\n                        console.log(res.data.access_token)\r\n                        var _access_token = res.data.access_token\r\n                        let Message_url = 'https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=' + _access_token\r\n                        getApp().core.showLoading({\r\n                            title: \"正在提交\",\r\n                            mask: !0\r\n                        }), app.request({\r\n                            url: e,\r\n                            method: \"post\",\r\n                            data: r,\r\n                            success: function (e) {\r\n                                if (0 == e.code) {\r\n                                    var t = function () {\r\n                                        app.request({\r\n                                            url: p,\r\n                                            data: {\r\n                                                order_id: d,\r\n                                                order_id_list: o,\r\n                                                pay_type: a,\r\n                                                form_id: r.formId,\r\n                                                parent_user_id: m,\r\n                                                condition: 2\r\n                                            },\r\n                                            success: function (e) {\r\n                                                // h获取订单编号\r\n                                                getApp().request({\r\n                                                    url: getApp().api.order.detail,\r\n                                                    data: {\r\n                                                        order_id: d\r\n                                                    },\r\n                                                    success: function (e) {\r\n                                                        console.log(e.data)\r\n                                                        //进行订阅信息弹窗授权\r\n                                                        var open_Id = 'o7RSe4vjs8_0pVlTTQn8Y8C1VIvo'\r\n                                                        wx.requestSubscribeMessage({\r\n                                                            tmplIds: ['9_o1f7zU4g42YEIl-8jjkc7qFciP7UWr_qByz5L4S5s'],\r\n                                                            success(res) {\r\n                                                                console.log(res)\r\n                                                                console.log('成功')\r\n                                                                //订阅信息数据\r\n                                                                let jsonData = {\r\n                                                                    access_token: _access_token,\r\n                                                                    touser: open_Id,\r\n                                                                    template_id: '9_o1f7zU4g42YEIl-8jjkc7qFciP7UWr_qByz5L4S5s',\r\n                                                                    page: \"pages/order/order\",\r\n                                                                    data: {\r\n                                                                        \"amount1\": {\"value\": e.data.total_price + '元'},\r\n                                                                        \"date2\": {\"value\": e.data.addtime},\r\n                                                                        \"character_string3\": {\"value\": e.data.order_no},\r\n                                                                        \"character_string7\": {\"value\": e.data.integral.forehead},\r\n                                                                        \"thing8\": {\"value\": e.data.status},\r\n                                                                    },\r\n                                                                    miniprogram_state: 'developer',\r\n                                                                }\r\n                                                                //订阅信息发送\r\n                                                                wx.request({\r\n                                                                    url: Message_url,\r\n                                                                    data: jsonData,\r\n                                                                    method: 'POST',\r\n                                                                    success(res) {\r\n                                                                        console.log(res.data.errcode)\r\n                                                                    },\r\n                                                                    complete(e) {\r\n                                                                        console.log(e)\r\n                                                                    }\r\n                                                                })\r\n                                                            },\r\n                                                            fail(err) {\r\n                                                                console.log(err)\r\n                                                                console.log('失败')\r\n                                                            }\r\n                                                        })\r\n                                                        if (0 != e.code) return getApp().core.hideLoading(), void getApp().core.showModal({\r\n                                                            title: \"提示\",\r\n                                                            content: e.msg,\r\n                                                            showCancel: !1,\r\n                                                            confirmText: \"确认\",\r\n                                                            success: function (e) {\r\n                                                                e.confirm && getApp().core.redirectTo({\r\n                                                                    url: u + \"?status=0\",\r\n                                                                });\r\n                                                            }\r\n                                                        });\r\n                                                        setTimeout(function () {\r\n                                                            getApp().core.hideLoading();\r\n                                                        }, 1e3), \"pt\" == g ? \"ONLY_BUY\" == _.page.data.type ? getApp().core.redirectTo({\r\n                                                            url: u + \"?status=2\"\r\n                                                        }) : getApp().core.redirectTo({\r\n                                                            url: \"/pages/pt/group/details?oid=\" + d\r\n                                                        }) : void 0 !== _.page.data.goods_card_list && 0 < _.page.data.goods_card_list.length && 2 != r.payment ? _.page.setData({\r\n                                                            show_card: !0\r\n                                                        }) : getApp().core.redirectTo({\r\n                                                            url: u + \"?status=-1\",\r\n                                                        });\r\n                                                    }\r\n                                                })\r\n                                            }\r\n                                        });\r\n                                    };\r\n                                    if (getApp().page.bindParent({\r\n                                        parent_id: m,\r\n                                        condition: 1\r\n                                    }), null != e.data.p_price && 0 === e.data.p_price) return \"step\" == g ? getApp().core.showToast({\r\n                                        title: \"兑换成功\"\r\n                                    }) : getApp().core.showToast({\r\n                                        title: \"提交成功\"\r\n                                    }), void setTimeout(function () {\r\n                                        getApp().core.redirectTo({\r\n                                            url: \"/pages/order/order?status=1\"\r\n                                        });\r\n                                    }, 2e3);\r\n                                    setTimeout(function () {\r\n                                        _.page.setData({\r\n                                            options: {}\r\n                                        });\r\n                                    }, 1);\r\n                                    var d = e.data.order_id || \"\",\r\n                                        o = e.data.order_id_list ? JSON.stringify(e.data.order_id_list) : \"\", a = \"\";\r\n                                    0 == r.payment ? app.request({\r\n                                        url: p,\r\n                                        data: {\r\n                                            order_id: d,\r\n                                            order_id_list: o,\r\n                                            pay_type: \"WECHAT_PAY\",\r\n                                            parent_user_id: m,\r\n                                            condition: 2\r\n                                        },\r\n                                        success: function (e) {\r\n                                            if (0 != e.code) {\r\n                                                if (1 == e.code) return getApp().core.hideLoading(), void getApp().core.showToast({\r\n                                                    title: e.msg,\r\n                                                    image: \"/images/icon-warning.png\"\r\n                                                });\r\n                                            } else {\r\n                                                setTimeout(function () {\r\n                                                    getApp().core.hideLoading();\r\n                                                }, 1e3), setOnShowScene(\"pay\"), e.data && 0 == e.data.price ? void 0 !== _.page.data.goods_card_list && 0 < _.page.data.goods_card_list.length ? _.page.setData({\r\n                                                    show_card: !0\r\n                                                }) : getApp().core.redirectTo({\r\n                                                    url: u + \"?status=1\"\r\n                                                }) : getApp().core.requestPayment({\r\n                                                    _res: e,\r\n                                                    timeStamp: e.data.timeStamp,\r\n                                                    nonceStr: e.data.nonceStr,\r\n                                                    package: e.data.package,\r\n                                                    signType: e.data.signType,\r\n                                                    paySign: e.data.paySign,\r\n                                                    success: function (e) {\r\n                                                    },\r\n                                                    fail: function (e) {\r\n                                                    },\r\n                                                    complete: function (e) {\r\n                                                        \"requestPayment:fail\" != e.errMsg && \"requestPayment:fail cancel\" != e.errMsg ? \"requestPayment:ok\" != e.errMsg || (void 0 !== _.page.data.goods_card_list && 0 < _.page.data.goods_card_list.length ? _.page.setData({\r\n                                                            show_card: !0\r\n                                                        }) : \"pt\" == g ? \"ONLY_BUY\" == _.page.data.type ? getApp().core.redirectTo({\r\n                                                            url: u + \"?status=2\"\r\n                                                        }) : getApp().core.redirectTo({\r\n                                                            url: \"/pages/pt/group/details?oid=\" + d\r\n                                                        }) : getApp().core.redirectTo({\r\n                                                            url: u + \"?status=1\"\r\n                                                        })) : getApp().core.showModal({\r\n                                                            title: \"提示\",\r\n                                                            content: \"订单尚未支付\",\r\n                                                            showCancel: !1,\r\n                                                            confirmText: \"确认\",\r\n                                                            success: function (e) {\r\n                                                                e.confirm && getApp().core.redirectTo({\r\n                                                                    url: u + \"?status=0\"\r\n                                                                });\r\n                                                            }\r\n                                                        });\r\n                                                    }\r\n                                                });\r\n                                                var t = getApp().core.getStorageSync(getApp().const.QUICK_LIST);\r\n                                                if (t) {\r\n                                                    for (var o = t.length, a = 0; a < o; a++) for (var r = t[a].goods, p = r.length, s = 0; s < p; s++) r[s].num = 0;\r\n                                                    getApp().core.setStorageSync(getApp().const.QUICK_LISTS, t);\r\n                                                    var n = getApp().core.getStorageSync(getApp().const.CARGOODS);\r\n                                                    for (o = n.length, a = 0; a < o; a++) n[a].num = 0, n[a].goods_price = 0, l.setData({\r\n                                                        carGoods: n\r\n                                                    });\r\n                                                    getApp().core.setStorageSync(getApp().const.CARGOODS, n);\r\n                                                    var c = getApp().core.getStorageSync(getApp().const.TOTAL);\r\n                                                    c && (c.total_num = 0, c.total_price = 0, getApp().core.setStorageSync(getApp().const.TOTAL, c));\r\n                                                    getApp().core.getStorageSync(getApp().const.CHECK_NUM);\r\n                                                    0, getApp().core.setStorageSync(getApp().const.CHECK_NUM, 0);\r\n                                                    var i = getApp().core.getStorageSync(getApp().const.QUICK_HOT_GOODS_LISTS);\r\n                                                    for (o = i.length, a = 0; a < o; a++) i[a].num = 0, l.setData({\r\n                                                        quick_hot_goods_lists: i\r\n                                                    });\r\n                                                    getApp().core.setStorageSync(getApp().const.QUICK_HOT_GOODS_LISTS, i);\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }) : 2 == r.payment ? (a = \"HUODAO_PAY\", t()) : 3 == r.payment && (a = \"BALANCE_PAY\",\r\n                                        t());\r\n                                }\r\n                                1 == e.code && (getApp().core.hideLoading(), \"活力币不足\" == e.msg && _.page.data.store.option.step.currency_name ? getApp().core.showToast({\r\n                                    icon: \"none\",\r\n                                    title: _.page.data.store.option.step.currency_name + \"不足\"\r\n                                }) : getApp().core.showToast({\r\n                                    icon: \"none\",\r\n                                    title: e.msg\r\n                                }));\r\n                            }\r\n                        });\r\n                    }\r\n                })\r\n            }\r\n\r\n        };\r\n    }\r\n};\r\n\r\nmodule.exports = pay;
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- core/order-pay.js	(revision a2bccea3733dbced41cc15afb97d9268c0474570)
+++ core/order-pay.js	(date 1606975008791)
@@ -132,15 +132,15 @@
             } else o();
 
             function o() {
-                var appId = 'wx257210a837db11b0'
-                var appSecret = '512c724e265ce71c6868ba0aa0636bd3'
-                var url = 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=' + appId + '&secret=' + appSecret;
-                wx.request({
-                    url,
-                    success: (res) => {
-                        console.log(res.data.access_token)
-                        var _access_token = res.data.access_token
-                        let Message_url = 'https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=' + _access_token
+                // var appId = 'wx257210a837db11b0'
+                // var appSecret = '512c724e265ce71c6868ba0aa0636bd3'
+                // var url = 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=' + appId + '&secret=' + appSecret;
+                // wx.request({
+                //     url,
+                //     success: (res) => {
+                //         console.log(res.data.access_token)
+                //         var _access_token = res.data.access_token
+                //         let Message_url = 'https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=' + _access_token
                         getApp().core.showLoading({
                             title: "正在提交",
                             mask: !0
@@ -163,47 +163,47 @@
                                             },
                                             success: function (e) {
                                                 // h获取订单编号
-                                                getApp().request({
-                                                    url: getApp().api.order.detail,
-                                                    data: {
-                                                        order_id: d
-                                                    },
-                                                    success: function (e) {
-                                                        console.log(e.data)
-                                                        //进行订阅信息弹窗授权
-                                                        var open_Id = 'o7RSe4vjs8_0pVlTTQn8Y8C1VIvo'
+                                                // getApp().request({
+                                                //     url: getApp().api.order.detail,
+                                                //     data: {
+                                                //         order_id: d
+                                                    // },
+                                                    // success: function (e) {
+                                                        // console.log(e.data)
+                                                       //进行订阅信息弹窗授权
+                                                       //  var open_Id = 'o7RSe4vjs8_0pVlTTQn8Y8C1VIvo'
                                                         wx.requestSubscribeMessage({
                                                             tmplIds: ['9_o1f7zU4g42YEIl-8jjkc7qFciP7UWr_qByz5L4S5s'],
                                                             success(res) {
                                                                 console.log(res)
                                                                 console.log('成功')
-                                                                //订阅信息数据
-                                                                let jsonData = {
-                                                                    access_token: _access_token,
-                                                                    touser: open_Id,
-                                                                    template_id: '9_o1f7zU4g42YEIl-8jjkc7qFciP7UWr_qByz5L4S5s',
-                                                                    page: "pages/order/order",
-                                                                    data: {
-                                                                        "amount1": {"value": e.data.total_price + '元'},
-                                                                        "date2": {"value": e.data.addtime},
-                                                                        "character_string3": {"value": e.data.order_no},
-                                                                        "character_string7": {"value": e.data.integral.forehead},
-                                                                        "thing8": {"value": e.data.status},
-                                                                    },
-                                                                    miniprogram_state: 'developer',
-                                                                }
-                                                                //订阅信息发送
-                                                                wx.request({
-                                                                    url: Message_url,
-                                                                    data: jsonData,
-                                                                    method: 'POST',
-                                                                    success(res) {
-                                                                        console.log(res.data.errcode)
-                                                                    },
-                                                                    complete(e) {
-                                                                        console.log(e)
-                                                                    }
-                                                                })
+                                                              //订阅信息数据  这是虚拟化服务端发送请求
+                                                               //  let jsonData = {
+                                                               //      access_token: _access_token,
+                                                               //      touser: open_Id,
+                                                               //      template_id: '9_o1f7zU4g42YEIl-8jjkc7qFciP7UWr_qByz5L4S5s',
+                                                               //      page: "pages/order/order",
+                                                               //      data: {
+                                                               //          "amount1": {"value": e.data.total_price + '元'},
+                                                               //          "date2": {"value": e.data.addtime},
+                                                               //          "character_string3": {"value": e.data.order_no},
+                                                               //          "character_string7": {"value": e.data.integral.forehead},
+                                                               //          "thing8": {"value": e.data.status},
+                                                               //      },
+                                                               //      miniprogram_state: 'developer',
+                                                               //  }
+                                                             //  //订阅信息发送
+                                                               //  wx.request({
+                                                               //      url: Message_url,
+                                                               //      data: jsonData,
+                                                               //      method: 'POST',
+                                                               //      success(res) {
+                                                               //          console.log(res.data.errcode)
+                                                               //      },
+                                                               //      complete(e) {
+                                                               //          console.log(e)
+                                                               //      }
+                                                               //  })
                                                             },
                                                             fail(err) {
                                                                 console.log(err)
@@ -232,8 +232,8 @@
                                                         }) : getApp().core.redirectTo({
                                                             url: u + "?status=-1",
                                                         });
-                                                    }
-                                                })
+                                                    // }
+                                                // })
                                             }
                                         });
                                     };
@@ -342,8 +342,8 @@
                                     icon: "none",
                                     title: e.msg
                                 }));
-                            }
-                        });
+                        //     }
+                        // });
                     }
                 })
             }
